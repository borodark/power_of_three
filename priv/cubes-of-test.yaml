---
cubes:
  # Test cube 1: Simple customer analytics
  - name: test_customer_analytics
    sql_table: customer
    title: Test Customer Analytics
    description: Test cube for customer analytics with HTTP backend

    measures:
      - name: total_customers
        type: count
        description: Total number of customers

      - name: unique_emails
        type: count_distinct
        sql: email
        description: Count of unique email addresses

      - name: unique_brands
        type: count_distinct
        sql: brand_code
        description: Count of unique brands

    dimensions:
      - name: customer_id
        type: number
        sql: id
        primary_key: true

      - name: first_name
        type: string
        sql: first_name
        description: Customer first name

      - name: brand
        type: string
        sql: brand_code
        description: Brand code

      - name: market
        type: string
        sql: market_code
        description: Market code

      - name: email_domain
        type: string
        sql: "SUBSTRING(email FROM POSITION('@' IN email) + 1)"
        description: Email domain extracted from email address

      - name: created_date
        type: time
        sql: "DATE(inserted_at)"
        description: Customer creation date

  # Test cube 2: Order analytics
  - name: test_orders
    sql_table: public.order
    title: Test Orders
    description: Test cube for order analytics

    measures:
      - name: order_count
        type: count
        description: Total number of orders

      - name: total_revenue
        type: sum
        sql: total_amount
        description: Total revenue from all orders

      - name: avg_order_value
        type: avg
        sql: total_amount
        description: Average order value

      - name: total_tax
        type: sum
        sql: tax_amount
        description: Total tax collected

    dimensions:
      - name: order_id
        type: number
        sql: id
        primary_key: true

      - name: financial_status
        type: string
        sql: financial_status
        description: Payment status of the order

      - name: fulfillment_status
        type: string
        sql: fulfillment_status
        description: Fulfillment status of the order

      - name: order_market
        type: string
        sql: market_code
        description: Market where order was placed

      - name: order_brand
        type: string
        sql: brand_code
        description: Brand for the order

  # Test cube 3: Address analytics
  - name: test_addresses
    sql_table: address
    title: Test Addresses
    description: Test cube for address analytics

    measures:
      - name: address_count
        type: count
        description: Total number of addresses

      - name: countries_count
        type: count_distinct
        sql: country
        description: Number of unique countries

    dimensions:
      - name: address_id
        type: number
        sql: id
        primary_key: true

      - name: address_type
        type: string
        sql: kind
        description: Type of address (billing, shipping, etc.)

      - name: country
        type: string
        sql: country
        description: Country code

      - name: address_brand
        type: string
        sql: brand_code
        description: Associated brand

      - name: address_market
        type: string
        sql: market_code
        description: Associated market
